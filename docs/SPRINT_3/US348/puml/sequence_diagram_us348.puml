@startuml
actor "Drone Tech" as User
participant "GenerateShowDSLUI" as UI
participant "GenerateShowDSLController" as Controller
participant "PersistenceContext" as Persistence
participant "RepositoryFactory" as Factory
participant "ShowProposalRepository" as Repo
participant "GenerateShowDSL" as Service
participant "ShowProposal" as Proposal
participant "ShowConfiguration" as Configuration
participant "ANTLRShowDSLValidatorPlugin" as Plugin
participant "ShowLexer" as Lexer
participant "ShowParser" as Parser
participant "ShowDSLDescription" as ShowDSLDescription

activate User

User -> UI : request DSL generation for proposal
activate UI

UI -> Controller : proposalListReadyGenerateShowDSL()
activate Controller

Controller -> Persistence : PersistenceContext()
activate Persistence

Persistence -> Factory : repositories()
deactivate Persistence

activate Factory
Factory -> Repo : proposals()
deactivate Factory

activate Repo
Repo -> Repo : findProposalsReadyGenerateShowDSL()

Repo --> Controller : list of proposals
deactivate Repo

Controller --> UI : proposals
deactivate Controller

UI -> User : show proposals
User -> UI : select proposal

UI -> Controller : generateDSL(proposal)
activate Controller

Controller -> Service : generateFrom(proposal)
activate Service

Service -> Proposal : getConfiguration()
activate Proposal
Proposal --> Service : configuration
deactivate Proposal

Service -> Configuration : getFigures()
activate Configuration

Configuration --> Service : list of figures
deactivate Configuration

Service -> Service : createShowDSLContent(figures)
activate Service
deactivate Service

Service -> Plugin : validate(ShowDSLContent)
activate Plugin

Plugin -> Lexer : new ShowLexer(input)
activate Lexer

Lexer --> Plugin : token stream
deactivate Lexer

Plugin -> Parser : new ShowParser(tokens)
activate Parser

Parser -> Parser : parser.start()
activate Parser
deactivate Parser

Parser --> Plugin : parse result (success/errors)
deactivate Parser

Plugin -> Service : ValidationResult
deactivate Plugin

alt Validation successful
    Service -> ShowDSLDescription : create ShowDSLDescription
    activate ShowDSLDescription
    deactivate ShowDSLDescription

    Service --> Controller : ShowDSLDescription
    deactivate Service

    Controller -> Proposal : addShowDSLDescription(DSLDescription)
    activate Proposal
    deactivate Proposal

    Controller -> Repo : save(proposal)
    activate Repo
    deactivate Repo

    Controller --> UI : show success
    deactivate Controller

    UI --> User : show DSL generation success
    deactivate UI
    deactivate User

else Validation failed
    Service -> Controller : show validation errors
    activate Service
    deactivate Service
    activate Controller

    Controller -> UI : show validation errors
    deactivate Controller
    activate UI

    UI --> User : show validation errors
    activate User
    deactivate UI
    deactivate User
end
@enduml
