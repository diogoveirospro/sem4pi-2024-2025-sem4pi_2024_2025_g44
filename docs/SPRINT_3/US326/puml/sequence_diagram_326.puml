@startuml
'skinparam monochrome

skinparam packageStyle rectangle
skinparam shadowing false

autonumber

actor "Drone Tech" as DT
participant ":MaintenanceUI" as UI
participant ":MaintenanceController" as CTRL
participant ":Persistence" as PERS
participant ":RepositoryFactory" as REPOS
participant ":DroneRepository" as DRONE_REPO
participant ":MaintenanceRepository" as MAINT_REPO
participant ":Maintenance" as MAINT

activate DT

DT -> UI : request to add maintenance (droneId, maintenanceType, date, description, technician)
activate UI
    UI -> CTRL : collect maintenance data
    activate CTRL

    CTRL --> PERS : getRepositoryFactory()
    activate PERS
    PERS --> CTRL : repositoryFactory
    deactivate PERS

    CTRL -> REPOS : getInstance()
    activate REPOS
    REPOS --> CTRL : repositories
    deactivate REPOS

    CTRL -> REPOS : getDroneRepository()
    activate REPOS
    REPOS --> CTRL : droneRepository
    deactivate REPOS

    CTRL -> DRONE_REPO : findBySerialNumber(droneId)
    activate DRONE_REPO
    DRONE_REPO --> CTRL : drone (exists, active status)
    deactivate DRONE_REPO

    alt if drone is active
        CTRL -> REPOS : getMaintenanceRepository()
        activate REPOS
        REPOS --> CTRL : maintenanceRepository
        deactivate REPOS

        CTRL -> MAINT_REPO : addMaintenance(droneId, maintenanceType, date, description, technician)
        activate MAINT_REPO
        MAINT_REPO --> CTRL : maintenance record added
        deactivate MAINT_REPO

        CTRL -> MAINT : createMaintenanceRecord(droneId, maintenanceType, date, description, technician)
        activate MAINT
        MAINT --> CTRL : maintenanceRecord
        deactivate MAINT

        CTRL -> MAINT_REPO : save(maintenanceRecord)
        activate MAINT_REPO
        MAINT_REPO --> CTRL : success
        deactivate MAINT_REPO

        CTRL --> UI : show success message
    else if drone is inactive
        CTRL --> UI : show error message ("Drone is not active")
    end

    deactivate CTRL
UI --> DT : display result (success or error)
deactivate UI
deactivate DT
@enduml
