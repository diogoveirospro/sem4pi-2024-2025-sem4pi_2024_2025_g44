@startuml
set separator none
left to right direction

package "Persistence " #DDDDDD {
    class PersistenceContext {
        + getRepositoryFactory(): RepositoryFactory
    }
}

package "persistence.impl.jpa" #DDDDDD {
    class JpaRepositoryFactory {
        - JpaRepositoryFactory()
        + getInstance(): RepositoryFactory
    }

    class JpaFigureRepository {
    }

    class JpaCategoryRepository {
    }

    class JpaCustomerRepository {
    }

}

package "persistence.impl.inmemory" #DDDDDD {
    class InMemoryRepositoryFactory {
        - InMemoryRepositoryFactory()
        + getInstance(): RepositoryFactory
    }

    class InMemoryFigureRepository {
    }

    class InMemoryCategoryRepository {
    }

    class InMemoryCustomerRepository {
    }
}

package "Domain" #DDDDDD {

    package "Repository " #DDDDDD {

        interface RepositoryFactory {
            + getFigureRepository(): FigureRepository
            + getCategoryRepository(): CategoryRepository
            + getCustomerRepository(): CustomerRepository
        }

        interface FigureRepository {
            + save(figure): Figure
        }

        interface CategoryRepository {
            + findAll(): Iterable<Category>
        }

        interface CustomerRepository {
            + findAll(): Iterable<Customer>
        }

    }

    'Figure Aggregate
    class Figure <<Entity>>{
        + Figure(code, version, description, dslDescription, keywords, categories, showDesigner)
        + Figure(code, version, description, dslDescription, keywords, categories, showDesigner, exclusivity)
    }

    class Code <<Value Object>>{
    }

    class Version <<Value Object>>{
    }

    class Description <<Value Object>>{
    }

    class DSLDescription <<Value Object>>{
    }

    class Keyword <<Value Object>>{
    }

    class Exclusivity <<Entity>>{
    }


    'Category Aggregate
    class Category <<Entity>>{
    }


    'ShowDesigner Aggregate
    class ShowDesigner <<Entity>>{
    }

    'Customer Aggregate
    class Customer <<Entity>>{
    }

}

package "UI" #DDDDDD {
    class AddFigureToCatalogueUI <<UI>> {
        + addPublicFigureToCatalogue(code, version, description, dslDescription, keywords, categories, showDesigner)
        + addExclusiveFigureToCatalogue(code, version, description, dslDescription, keywords, categories, showDesigner, exclusivity)
        + showCategoriesAndSelect()
        + showCustomersAndSelect()
    }
}

package "Controller" #DDDDDD {
    class AddFigureToCatalogueController <<Controller>> {
        + addPublicFigureToCatalogue(code, version, description, dslDescription, keywords, categories, showDesigner): boolean
        + addExclusiveFigureToCatalogue(code, version, description, dslDescription, keywords, categories, showDesigner, exclusivity): boolean
        + listCategories(): Iterable<Category>
        + listCustomers(): Iterable<Customer>
    }
}

'Persistence

    'PersistenceContext -> x
    PersistenceContext ..> RepositoryFactory: figureRepository()\ncategoryRepository()\ncustomerRepository()
    PersistenceContext ..> JpaRepositoryFactory
    PersistenceContext ..> InMemoryRepositoryFactory

'persistence.impl.jpa

    'JpaFigureRepository -> x
    JpaFigureRepository --|> FigureRepository

    'JpaCategoryRepository -> x
    JpaCategoryRepository --|> CategoryRepository

    'JpaCustomerRepository -> x
    JpaCustomerRepository --|> CustomerRepository

    'JpaRepositoryFactory -> x
    JpaRepositoryFactory ....|> RepositoryFactory
    JpaRepositoryFactory ..> JpaFigureRepository
    JpaRepositoryFactory ..> JpaCategoryRepository
    JpaRepositoryFactory ..> JpaCustomerRepository

'persistence.impl.inmemory

    'InMemoryFigureRepository -> x
    InMemoryFigureRepository ..|> FigureRepository

    'InMemoryCategoryRepository -> x
    InMemoryCategoryRepository ..|> CategoryRepository

    'InMemoryCustomerRepository -> x
    InMemoryCustomerRepository ..|> CustomerRepository

    'InMemoryRepositoryFactory -> x
    InMemoryRepositoryFactory ...|> RepositoryFactory
    InMemoryRepositoryFactory ..> InMemoryFigureRepository
    InMemoryRepositoryFactory ..> InMemoryCategoryRepository
    InMemoryRepositoryFactory ..> InMemoryCustomerRepository

'Repository

    'FigureRepository -> x
    FigureRepository ...> Figure

    'CategoryRepository -> x
    CategoryRepository ...> Category

    'CustomerRepository -> x
    CustomerRepository ...> Customer

    'RepositoryFactory -> x
    RepositoryFactory ..> FigureRepository
    RepositoryFactory ..> CategoryRepository
    RepositoryFactory ..> CustomerRepository

'Domain

    'Figure -> x
    Figure --> "1" DSLDescription: DSLDescription
    Figure --> "1..*" Keyword: keywords
    Figure --> "1" Code: code
    Figure --> "1" Version: version
    Figure --> "1" Description: description
    Figure --> "1..*" Category: categories
    Figure --> "1" ShowDesigner: created by
    Figure --> "0..1" Exclusivity: exclusivity

    'Exclusivity -> x
    Exclusivity --> "1" Customer: exclusive to

'UI

    'AddFigureToCatalogueUI -> x
    AddFigureToCatalogueUI ..> AddFigureToCatalogueController

'Controller

    'AddFigureToCatalogueController -> x
    AddFigureToCatalogueController ..> PersistenceContext : getRepositoryFactory()
    AddFigureToCatalogueController ..> RepositoryFactory : getFigureRepository()
    AddFigureToCatalogueController ..> RepositoryFactory : getCategoryRepository()
    AddFigureToCatalogueController ..> RepositoryFactory : getCustomerRepository()
    AddFigureToCatalogueController ..> FigureRepository : save(figure)
    AddFigureToCatalogueController ..> CategoryRepository : findAll()


@enduml